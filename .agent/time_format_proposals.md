# ChroLens Mimic 時間戳記簡化方案分析

## 🎯 問題分析

### 當前問題

1. **錄製時**：使用絕對時間 (T=0s000, T=1s050)
2. **手動編輯時**：預設都是 T=0s000
3. **混合編輯**：錄製 + 手動編輯 = 時間混亂

### 目標

- 簡化時間表示
- 淺顯易懂
- 避免混亂
- 方便編輯

---

## 💡 方案一：純相對延遲（推薦）⭐⭐⭐⭐⭐

### 概念

**完全移除絕對時間，只保留動作延遲**

### 語法

```
>按下7,50ms      # 按住 50ms
>按下8,1050ms    # 按住 50ms，然後等待 1000ms，總共 1050ms
>點擊(100,200),50ms
```

### 優點

✅ 最簡單直覺
✅ 無需計算絕對時間
✅ 易於手動編輯
✅ 時間含義清晰：「這個動作要持續多久」

### 缺點

❌ 無法一眼看出腳本總時長
❌ 需要累加才知道某動作在第幾秒執行

### 實現方式

```python
# 錄製時計算
last_action_time = 0
for event in events:
    current_time = event.time
    # 計算從上個動作到現在的總時間
    total_delay = (current_time - last_action_time) * 1000
    lines.append(f'>按{key},{total_delay}ms')
    last_action_time = current_time
```

### 範例

```
# 原本（舊格式）
>按a, 延遲50ms, T=0s000
>延遲1000ms, T=0s050
>按b, 延遲50ms, T=1s050

# 方案一
>按a,50ms
>按b,1050ms    # 自動包含了 1000ms 的等待
```

---

## 💡 方案二：顯式間隔 + 動作延遲

### 概念

**明確區分「等待時間」和「動作時間」**

### 語法

```
>按下7,50ms          # 動作持續時間
>等待1000ms          # 明確的等待
>按下8,50ms
```

### 優點

✅ 語義清晰
✅ 易於理解
✅ 方便插入等待

### 缺點

❌ 行數較多
❌ 簡單操作也需要兩行

### 範例

```
>按a,50ms
>等待1000ms
>按b,50ms
```

---

## 💡 方案三：累計時間標記（可選）

### 概念

**保留絕對時間，但作為可選註解**

### 語法

```
>按a,50ms           # @0.05s
>按b,1050ms         # @1.10s (可選標記)
```

### 優點

✅ 兼顧簡潔和可讀性
✅ 可選標記不影響執行
✅ 方便查看時間軸

### 缺點

❌ 需要維護註解
❌ 手動編輯時容易不同步

---

## 💡 方案四：時間軸模式

### 概念

**使用相對時間偏移**

### 語法

```
+0ms: >按a,50ms
+1000ms: >按b,50ms
+500ms: >點擊(100,200),50ms
```

### 優點

✅ 時間關係一目了然
✅ 易於調整間隔
✅ 類似專業工具（如 After Effects）

### 缺點

❌ 語法較複雜
❌ 不夠直覺
❌ 增加學習成本

---

## 💡 方案五：智能推斷模式

### 概念

**系統自動推斷時間，用戶只寫動作**

### 語法

```
>按a              # 預設 50ms
>等待1s           # 明確等待
>按b              # 預設 50ms
---
或使用預設延遲：
[預設延遲: 50ms]
>按a
>按b,100ms        # 覆蓋預設
```

### 優點

✅ 極簡語法
✅ 適合快速編寫
✅ 減少重複

### 缺點

❌ 隱式行為可能造成困惑
❌ 不適合精確控制
❌ 預設值難以選擇

---

## 📊 方案對比表

| 方案               |   簡潔度   |   易讀性   |   精確度   |  編輯便利  |   推薦度   |
| :----------------- | :--------: | :--------: | :--------: | :--------: | :--------: |
| 方案一：純相對延遲 | ⭐⭐⭐⭐⭐ |  ⭐⭐⭐⭐  | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| 方案二：顯式間隔   |   ⭐⭐⭐   | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |  ⭐⭐⭐⭐  |  ⭐⭐⭐⭐  |
| 方案三：累計標記   |  ⭐⭐⭐⭐  | ⭐⭐⭐⭐⭐ |  ⭐⭐⭐⭐  |   ⭐⭐⭐   |   ⭐⭐⭐   |
| 方案四：時間軸     |    ⭐⭐    |   ⭐⭐⭐   | ⭐⭐⭐⭐⭐ |    ⭐⭐    |    ⭐⭐    |
| 方案五：智能推斷   | ⭐⭐⭐⭐⭐ |    ⭐⭐    |   ⭐⭐⭐   |  ⭐⭐⭐⭐  |    ⭐⭐    |

---

## 🎯 推薦方案：方案一（純相對延遲）

### 為什麼選擇方案一？

1. **最符合直覺**
   - 「這個按鍵要按多久？」→ 直接寫數字
   - 不需要理解「絕對時間」的概念

2. **最易於編輯**

   ```
   # 想在兩個動作間加 500ms？
   # 舊方式：需要重新計算所有後續的 T= 值
   # 新方式：只需修改下一個動作的延遲
   >按a,50ms
   >按b,1550ms  # 原本 1050ms，加 500ms = 1550ms
   ```

3. **最適合錄製**
   - 錄製時自動計算總延遲
   - 無需維護兩套時間系統

4. **最容易理解**
   - 新手：「數字就是等待時間」
   - 進階：可以精確控制每個動作

### 實際範例對比

**場景：按 a，等 1 秒，按 b，等 0.5 秒，點擊**

```
# 舊格式（v2.7.6）
>按a, 延遲50ms, T=0s000
>延遲1000ms, T=0s050
>按b, 延遲50ms, T=1s050
>延遲500ms, T=1s100
>左鍵點擊(100,200), 延遲50ms, T=1s600

# 當前格式（v2.7.7 初版）
>按a,50ms
>間隔1000ms
>按b,50ms
>間隔500ms
>左鍵點擊(100,200),50ms

# 方案一（推薦）
>按a,50ms
>按b,1050ms      # 包含 1000ms 等待
>左鍵點擊(100,200),550ms  # 包含 500ms 等待
```

---

## 🔧 實施建議

### 階段一：基礎實現

1. 修改錄製邏輯，計算累計延遲
2. 移除 `>間隔` 指令
3. 所有延遲合併到動作中

### 階段二：編輯器優化

1. 提供「插入等待」功能
   - 自動將等待時間加到下一個動作
2. 時間計算器
   - 顯示每個動作的實際執行時間點

### 階段三：視覺化

1. 時間軸視圖（可選）
2. 顯示累計時間（如方案三的註解）

---

## 💬 其他考量

### Q: 如果只想等待，不做動作怎麼辦？

A: 使用特殊的「空動作」

```
>等待1000ms
# 或
>延遲1000ms
```

### Q: 如何快速查看總時長？

A: 編輯器底部顯示統計資訊

```
總時長: 5.2 秒
動作數: 12
```

### Q: 舊腳本如何轉換？

A: 自動轉換邏輯

```python
# >間隔1000ms + >按b,50ms
# → >按b,1050ms
```

---

## 🎯 最終建議

**採用方案一：純相對延遲**

理由：

1. ✅ 最簡單
2. ✅ 最直覺
3. ✅ 最易編輯
4. ✅ 最符合「動作導向」的設計哲學

這個方案將時間完全融入動作中，用戶不需要思考「時間軸」，只需要思考「這個動作要持續多久」。
