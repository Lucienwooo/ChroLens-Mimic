# ChroLens Mimic v2.7.7 - 時間語法統一化實施計畫

## 📋 目標

將所有時間格式從「絕對時間模式」改為「間隔模式」

### 舊格式 (v2.7.6)

```
>按下7, 延遲50ms, T=0s000
>延遲1000ms, T=0s050
>點擊(100,200), 延遲50ms, T=1s050
```

### 新格式 (v2.7.7)

```
>按下7, 50ms
>間隔1000ms
>點擊(100,200), 50ms
```

## 🎯 核心變更

### 1. 移除 `T=` 時間戳

- 所有指令不再包含 `T=0s000` 格式
- 改用 `>間隔XXXms` 指令表示動作之間的等待

### 2. 簡化延遲語法

- `延遲50ms` → `50ms` (直接寫在指令後)
- `延遲0ms` → 可省略或寫 `0ms`

### 3. 新增 `>間隔` 指令

- 用於控制動作之間的等待時間
- 取代原本的絕對時間計算

## 📁 需要修改的檔案

### A. 錄製系統 (recorder.py)

- [ ] 修改錄製時的時間記錄邏輯
- [ ] 改為記錄「間隔時間」而非「絕對時間」

### B. 文字腳本編輯器 (text_script_editor.py)

- [ ] 修改 `convert_to_text_script()` - 錄製轉文字
- [ ] 修改所有解析函數 (parse_command_to_json)
- [ ] 修改所有指令按鈕的範例
- [ ] 修改快速插入指令的模板

### C. 指令參考手冊 (指令參考手冊.json)

- [ ] 更新所有範例指令格式

### D. 主程式 (ChroLens_Mimic.py)

- [ ] 檢查是否有相關時間處理邏輯

## 🔄 轉換規則

### 按鍵指令

```python
# 舊: >按a, 延遲50ms, T=0s000
# 新: >按a, 50ms
```

### 滑鼠指令

```python
# 舊: >左鍵點擊(100,200), 延遲50ms, T=0s000
# 新: >左鍵點擊(100,200), 50ms
```

### 延遲指令

```python
# 舊: >延遲1000ms, T=0s000
# 新: >間隔1000ms
```

### 移動指令

```python
# 舊: >移動至(100,200), 延遲0ms, T=0s000
# 新: >移動至(100,200)  # 0ms可省略
```

## ✅ 測試檢查清單

### 1. 錄製測試

- [ ] 錄製滑鼠點擊
- [ ] 錄製鍵盤按鍵
- [ ] 錄製組合鍵
- [ ] 檢查生成的文字腳本格式

### 2. 腳本執行測試

- [ ] 執行新格式腳本
- [ ] 檢查時間間隔是否正確
- [ ] 檢查動作順序是否正確

### 3. 編輯器測試

- [ ] 插入指令按鈕
- [ ] 手動編輯腳本
- [ ] 儲存腳本
- [ ] 重新載入腳本

### 4. 轉換測試

- [ ] 文字 → JSON 轉換
- [ ] JSON → 文字 轉換
- [ ] 舊格式腳本相容性

## 📝 實施步驟

1. 更新版本號到 v2.7.7
2. 修改錄製系統 (recorder.py)
3. 修改文字編輯器 (text_script_editor.py)
4. 更新指令參考手冊
5. 執行完整測試
6. 更新官網文檔

## ⚠️ 注意事項

- 保持向下相容性（可選）
- 確保所有正則表達式正確匹配新格式
- 測試所有邊界情況（0ms, 大數值等）
