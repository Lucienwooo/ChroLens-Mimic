# v2.7.7 時間語法統一化 - 詳細修改指南

## ⚠️ 重要提醒

這是一個**重大語法變更**，建議：

1. 先使用「轉換腳本格式.bat」備份並轉換現有腳本
2. 完成所有代碼修改後再進行測試
3. 保留舊版本以便回滾

## 📝 核心修改清單

### A. text_script_editor.py - 錄製轉文字功能

#### 位置 1: convert_to_text_script() 函數 (~3600-3900行)

需要修改的模式：

```python
# 舊: lines.append(f">按下{key_name}, 延遲{press_delay}ms, T={time_str}\n")
# 新:
# 1. 計算間隔時間
# 2. 如果間隔 > 0，插入 >間隔XXms
# 3. 插入動作指令（不含 T=）
```

關鍵變更：

- 移除所有 `T={time_str}` 部分
- 將 `延遲XXms` 改為直接 `XXms`
- 在動作之間插入 `>間隔XXms` 指令

#### 位置 2: 所有解析函數 (~4900-5700行)

需要修改的正則表達式：

```python
# 舊: r'>按下(.+?), 延遲(\d+)ms, T=(\d+)s(\d+)'
# 新: r'>按下(.+?), (\d+)ms'

# 新增: r'>間隔(\d+)ms'  # 解析間隔指令
```

### B. 指令按鈕範例 (~2800-3250行)

所有快速插入按鈕的範例都需要更新：

```python
# 舊: (">按下a, 延遲50ms, T=0s000")
# 新: (">按下a, 50ms")
```

### C. 指令參考手冊.json

更新所有範例指令格式（約30處）

## 🔧 實施策略

由於修改量極大，建議分三個階段：

### 階段 1: 核心錄製功能 ✅

- convert_to_text_script() 函數
- 確保錄製產生新格式

### 階段 2: 解析與執行

- 所有 parse_command_to_json 函數
- 確保新格式能正確執行

### 階段 3: UI 與文檔

- 指令按鈕範例
- 指令參考手冊
- 官網文檔

## ⏱️ 預估時間

- 階段 1: 30分鐘
- 階段 2: 60分鐘
- 階段 3: 30分鐘
- 測試: 30分鐘
  **總計: 約 2.5 小時**

## 🎯 建議執行方式

考慮到修改的複雜度和風險，我建議：

**選項 A: 分階段實施**（推薦）

- 今天完成階段 1（錄製功能）
- 明天完成階段 2-3
- 充分測試後發布

**選項 B: 一次性完成**

- 需要連續 2.5 小時不中斷
- 風險較高，但能立即完成

您希望採用哪種方式？
