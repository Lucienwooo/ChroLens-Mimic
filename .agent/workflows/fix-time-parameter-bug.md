---
description: 修復時間參數儲存問題 (T=1s500 變成 T=0s000)
---

## 問題診斷

根據 Lucien 的回報，編輯器在儲存時會將時間參數（如 `T=1s500`）錯誤地轉換為 `T=0s000` 或數字減半。

### 可能原因

1. **浮點數精度問題**：在 `_format_time` 和 `_parse_time` 之間轉換時丟失精度
2. **時間基準點錯誤**：`start_time` 的計算或使用方式不正確
3. **事件時間戳記被覆蓋**：在 `_text_to_json` 轉換過程中，時間戳記被錯誤地重新計算

### 修復步驟

1. **檢查 `_text_to_json` 函數中的 `start_time` 使用**
   - 確認是否正確保留原始時間戳記
   - 檢查是否有重複計算導致時間累積錯誤

2. **驗證 `_format_time` 和 `_parse_time` 的往返轉換**
   - 測試：`T=1s500` → 解析 → 格式化 → 應該還是 `T=1s500`
   - 測試：`T=0s000` → 解析 → 格式化 → 應該還是 `T=0s000`

3. **修復 `_text_to_json` 中的時間計算邏輯**
   - 移除不必要的 `start_time` 加法
   - 直接使用解析後的相對時間

## 實施計劃

1. 建立測試腳本驗證問題
2. 修復 `text_script_editor.py` 中的時間處理邏輯
3. 測試儲存/載入循環，確保時間參數不變
