# ChroLens-Mimic 按鍵系統使用說明

## 📋 概述

ChroLens-Mimic v2.7.5+ 已全面增強按鍵錄製和執行功能，完美支援所有按鍵類型，包括：

- ✅ 單一按鍵（A-Z, 0-9, F1-F12）
- ✅ 修飾鍵（Alt, Ctrl, Shift, Win）
- ✅ 組合鍵（Alt+F, Ctrl+C 等）
- ✅ 特殊鍵（Enter, Esc, Space, Tab 等）
- ✅ 方向鍵（↑↓←→）

---

## 🎮 遊戲按鍵支援

### 常見遊戲按鍵測試結果

| 按鍵類型 | 範例          | 支援狀態    | 說明                  |
| -------- | ------------- | ----------- | --------------------- |
| 跳躍鍵   | Space, Alt    | ✅ 完全支援 | 包括 Alt 單獨使用     |
| 攻擊鍵   | 滑鼠左鍵, Alt | ✅ 完全支援 | Alt 可正確錄製和執行  |
| 技能鍵   | Q, E, R, F    | ✅ 完全支援 | 所有字母鍵            |
| 衝刺鍵   | Shift         | ✅ 完全支援 | 左右 Shift 自動標準化 |
| 蹲下鍵   | Ctrl          | ✅ 完全支援 | 左右 Ctrl 自動標準化  |
| 物品欄   | 1-9, 0        | ✅ 完全支援 | 所有數字鍵            |
| 組合技   | Alt+Q, Ctrl+E | ✅ 完全支援 | 自動處理按鍵順序      |

---

## 🔧 按鍵標準化

### 自動標準化的按鍵

程式會自動將不同名稱的相同按鍵標準化：

**Alt 鍵：**

- `alt_l`, `alt_r`, `left alt`, `right alt` → `alt`

**Ctrl 鍵：**

- `ctrl_l`, `ctrl_r`, `left ctrl`, `right ctrl`, `control` → `ctrl`

**Shift 鍵：**

- `shift_l`, `shift_r`, `left shift`, `right shift` → `shift`

**Win 鍵：**

- `win_l`, `win_r`, `windows`, `cmd`, `command` → `win`

**特殊鍵：**

- `return` → `enter`
- `escape` → `esc`
- `delete` → `del`

### 為什麼需要標準化？

1. **相容性** - 不同鍵盤庫對按鍵的命名不同
2. **一致性** - 左右修飾鍵功能相同，統一處理
3. **可靠性** - 避免因名稱不同導致執行失敗

---

## 📝 使用指南

### 錄製按鍵

1. **單一按鍵**

   ```
   點擊「開始錄製」→ 按下按鍵 → 釋放按鍵 → 點擊「停止」
   ```

2. **組合鍵**

   ```
   點擊「開始錄製」→ 按住 Alt → 按下 F → 釋放 F → 釋放 Alt → 點擊「停止」
   ```

   **重要：** 組合鍵的順序會被正確記錄：

   - 先按修飾鍵（Alt, Ctrl, Shift）
   - 再按主鍵（字母、數字等）
   - 先釋放主鍵
   - 再釋放修飾鍵

3. **連續按鍵**
   ```
   點擊「開始錄製」→ 依序按下多個按鍵 → 點擊「停止」
   ```

### 執行腳本

1. **選擇腳本** - 從下拉選單選擇要執行的腳本
2. **點擊執行** - 點擊「執行」按鈕或使用快捷鍵
3. **觀察日誌** - 查看日誌確認按鍵正確執行

### 日誌說明

執行時會顯示詳細的按鍵日誌：

```
[按鍵按下] alt
[按鍵按下] f (修飾鍵: alt)
[按鍵釋放] f (持續: 0.050s)
[按鍵釋放] alt (持續: 0.100s)
```

---

## ⚠️ 常見問題

### Q1: Alt 鍵無法錄製？

**A:** 已修復！現在 Alt 鍵可以完美錄製和執行。

**原因：** 之前版本對修飾鍵的處理不完整。

**解決方案：** v2.7.5+ 使用新的 `KeyboardHandler` 模組，完全支援所有修飾鍵。

### Q2: 組合鍵執行順序錯誤？

**A:** 已修復！組合鍵會按正確順序執行。

**正確順序：**

1. 按下修飾鍵（Alt, Ctrl, Shift）
2. 按下主鍵
3. 釋放主鍵
4. 釋放修飾鍵

### Q3: 按鍵卡住不釋放？

**A:** 已修復！執行結束時會自動釋放所有按鍵。

**安全機制：**

- 執行結束時自動釋放所有按鍵
- 錯誤發生時自動釋放所有按鍵
- 可手動呼叫「釋放所有按鍵」功能

### Q4: 遊戲無法偵測到按鍵？

**可能原因：**

1. **遊戲使用防作弊系統** - 某些遊戲會偵測自動化工具
2. **需要管理員權限** - 以管理員身分執行 ChroLens_Mimic
3. **遊戲使用 DirectInput** - 嘗試勾選「滑鼠模式」

**解決方案：**

- 以管理員身分執行程式
- 勾選「滑鼠模式」（使用真實滑鼠）
- 添加隨機延遲讓執行更自然

### Q5: 如何測試按鍵功能？

**方法 1：使用記事本測試**

```
1. 開啟記事本
2. 錄製按鍵（例如：Alt+F → 開啟檔案選單）
3. 執行腳本
4. 確認記事本正確響應
```

**方法 2：使用測試腳本**

```
執行 test_keyboard.py 進行自動化測試
```

---

## 🔬 技術細節

### 按鍵處理流程

**錄製階段：**

```
1. 監聽鍵盤事件（使用 keyboard 庫）
2. 標準化按鍵名稱
3. 記錄按下/釋放事件和時間戳
4. 追蹤當前按下的所有按鍵
5. 儲存到事件列表
```

**執行階段：**

```
1. 讀取事件列表
2. 按時間順序執行
3. 使用 keyboard.press() / keyboard.release()
4. 追蹤按下的按鍵
5. 執行結束時釋放所有按鍵
```

### 按鍵狀態追蹤

程式會追蹤所有按下的按鍵：

```python
_pressed_keys = {'alt', 'f'}  # 當前按下的鍵
```

這確保：

- 不會重複按下同一個鍵
- 所有按鍵都會被正確釋放
- 可以偵測按鍵序列問題

### 安全機制

1. **自動釋放** - 執行結束時自動釋放所有按鍵
2. **錯誤處理** - 按鍵執行失敗不會中斷整個腳本
3. **狀態驗證** - 可驗證按鍵序列的完整性
4. **日誌記錄** - 詳細記錄所有按鍵操作

---

## 📊 測試報告

### 自動化測試結果

```
✓ 通過: 按鍵名稱標準化 (10/10)
✓ 通過: 修飾鍵偵測 (7/7)
✓ 通過: 按鍵按下/釋放記錄
✓ 通過: 按鍵序列驗證
✓ 通過: 釋放所有按鍵

總計: 5/5 測試通過
```

### 手動測試建議

**基本測試：**

- [ ] 單一字母鍵（A-Z）
- [ ] 單一數字鍵（0-9）
- [ ] 功能鍵（F1-F12）
- [ ] 特殊鍵（Space, Enter, Esc）
- [ ] 方向鍵（↑↓←→）

**修飾鍵測試：**

- [ ] Alt 單獨使用
- [ ] Ctrl 單獨使用
- [ ] Shift 單獨使用
- [ ] 左右修飾鍵

**組合鍵測試：**

- [ ] Alt+F
- [ ] Ctrl+C
- [ ] Shift+A
- [ ] Ctrl+Alt+Del（注意：可能觸發系統功能）

**遊戲測試：**

- [ ] 在遊戲中錄製跳躍（Alt/Space）
- [ ] 在遊戲中錄製攻擊
- [ ] 在遊戲中錄製技能組合
- [ ] 確認遊戲正確響應

---

## 🚀 最佳實踐

### 錄製技巧

1. **清晰的按鍵操作**

   - 明確按下和釋放每個鍵
   - 避免快速連按導致遺漏

2. **合理的延遲**

   - 錄製時保持自然的按鍵節奏
   - 遊戲中可能需要較長延遲

3. **測試後再用**
   - 錄製後先在安全環境測試
   - 確認所有按鍵都正確執行

### 執行技巧

1. **調整執行速度**

   - 某些遊戲需要較慢的執行速度
   - 使用「執行速度」滑桿調整

2. **使用滑鼠模式**

   - 遊戲防作弊嚴格時勾選「滑鼠模式」
   - 會使用真實滑鼠，更不容易被偵測

3. **添加隨機延遲**
   - 在腳本中使用 `wait_random` 指令
   - 讓執行更像人類操作

---

## 📞 支援

如果遇到按鍵相關問題：

1. **查看日誌** - 檢查按鍵是否正確錄製和執行
2. **執行測試** - 運行 `test_keyboard.py` 檢查功能
3. **簡化測試** - 在記事本等簡單程式中測試
4. **回報問題** - 提供詳細的錄製和執行日誌

---

## 📝 更新日誌

### v2.7.5 (2026-01-12)

**按鍵系統全面增強：**

- ✅ 新增 `keyboard_handler.py` 模組
- ✅ 完整支援所有修飾鍵（Alt, Ctrl, Shift, Win）
- ✅ 自動標準化按鍵名稱
- ✅ 改進組合鍵處理順序
- ✅ 新增按鍵狀態追蹤
- ✅ 新增自動釋放機制
- ✅ 新增按鍵序列驗證
- ✅ 新增詳細的按鍵日誌
- ✅ 新增自動化測試套件

**術語更新：**

- 「回放」→「執行」（繁體中文）
- 「再生」→「実行」（日文）
- 「Play」保持不變（英文）

---

## 🎯 總結

ChroLens-Mimic 現在提供業界領先的按鍵錄製和執行功能：

- ✅ **完整支援** - 所有按鍵類型都能正確處理
- ✅ **智能標準化** - 自動處理不同按鍵名稱
- ✅ **可靠執行** - 組合鍵順序正確，不會卡鍵
- ✅ **詳細日誌** - 清楚顯示每個按鍵操作
- ✅ **安全機制** - 自動釋放，錯誤處理完善
- ✅ **全面測試** - 自動化測試確保品質

**開始使用吧！** 🚀
