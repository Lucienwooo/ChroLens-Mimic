# ChroLens Mimic 時間參數運作說明
## 更新日期：2026-01-27

---

## 📌 時間參數的兩個概念

在 ChroLens Mimic 中，時間參數有 **兩個獨立的概念**：

### 1. **T= 參數（累積時間戳記）**
- **用途**：記錄這個動作在整個腳本中的「絕對時間位置」
- **起點**：從腳本開始執行時的 `0s000` 開始計算
- **性質**：**累積的**，每個指令的 T= 會比前一個指令更大

### 2. **延遲參數（動作後等待時間）**
- **用途**：執行完這個動作後要等待多久才執行下一個動作
- **起點**：從這個動作執行完畢後開始計算
- **性質**：**獨立的**，每個指令的延遲互不影響

---

## 🔍 實際範例解析

### 範例指令
```
>移動至(100,200), 延遲500ms, T=3s000
```

### 運作流程

#### 步驟 1：等待到達時間點
```
腳本開始執行時間：0s000
目前指令的 T= 時間：3s000

→ 系統會等待 3 秒（從腳本開始算起）
→ 在第 3 秒時，開始執行這個「移動至(100,200)」動作
```

#### 步驟 2：執行動作
```
動作：移動滑鼠到座標 (100, 200)
執行時間：約 0.1 秒（視滑鼠移動距離而定）
```

#### 步驟 3：延遲等待
```
延遲參數：500ms

→ 動作執行完畢後，等待 500 毫秒（0.5 秒）
→ 然後才執行下一個指令
```

### 時間軸圖示
```
腳本時間軸：
0s000 ────────────────── 3s000 ───────── 3s500 ────────→
      ↑                  ↑              ↑
      腳本開始            執行移動        延遲結束
                        (約0.1秒)       (等待0.5秒)
                                       可執行下一個指令
```

---

## 📊 完整腳本範例

### 腳本內容
```
>移動至(100,100), 延遲0ms, T=0s000
>左鍵點擊(100,100), 延遲50ms, T=0s000
>移動至(200,200), 延遲500ms, T=1s000
>左鍵點擊(200,200), 延遲50ms, T=1s500
>輸入文字>Hello, T=2s000
```

### 執行時間軸
```
時間點    動作                     說明
───────────────────────────────────────────────────
0.000s   移動至(100,100)          立即執行（T=0s000）
0.100s   左鍵點擊(100,100)        移動完成後立即點擊（延遲0ms）
0.150s   [等待]                   點擊後延遲50ms

1.000s   移動至(200,200)          等到第1秒才執行（T=1s000）
1.100s   [等待]                   移動完成後延遲500ms
1.600s   [等待結束]               

1.600s   左鍵點擊(200,200)        延遲結束後立即執行（T=1s500 已過）
1.650s   [等待]                   點擊後延遲50ms

2.000s   輸入文字>Hello           等到第2秒才執行（T=2s000）
2.050s   [腳本結束]
```

---

## ⚙️ 系統運作邏輯

### 程式碼層面的處理

#### 1. 解析時間參數
```python
def _parse_time(self, time_str: str) -> float:
    """解析時間字串為秒數"""
    # T=3s500 → 3.5 秒
    # T=1m30s500 → 90.5 秒
    
    time_str = time_str.replace("T=", "").strip()
    total_seconds = 0.0
    
    # 解析分鐘
    if "m" in time_str:
        parts = time_str.split("m")
        total_seconds += float(parts[0]) * 60
        time_str = parts[1]
    
    # 解析秒和毫秒
    if "s" in time_str:
        parts = time_str.split("s")
        total_seconds += float(parts[0])  # 秒
        if len(parts) > 1 and parts[1]:
            total_seconds += float(parts[1]) / 1000  # 毫秒
    
    return total_seconds
```

#### 2. 執行事件序列
```python
# 偽程式碼示意
script_start_time = time.time()  # 記錄腳本開始時間

for event in events:
    # 1. 等待到達 T= 指定的時間點
    target_time = event['time']  # 這是從 T= 解析出來的絕對時間
    current_elapsed = time.time() - script_start_time
    
    if target_time > current_elapsed:
        wait_time = target_time - current_elapsed
        time.sleep(wait_time)  # 等待到達時間點
    
    # 2. 執行動作
    execute_action(event)  # 執行滑鼠移動、點擊等
    
    # 3. 動作後延遲
    if 'delay' in event:
        time.sleep(event['delay'] / 1000)  # 延遲參數（毫秒轉秒）
```

---

## 🎯 常見問題解答

### Q1：為什麼需要 T= 參數？
**A**：T= 參數確保腳本的「時間精確性」。

**範例情境**：
```
假設您錄製了一個「點擊按鈕 → 等待載入 → 點擊下一步」的流程：

錄製時：
- 0s000: 點擊按鈕
- 2s500: 點擊下一步（因為載入花了 2.5 秒）

執行時：
- 如果沒有 T= 參數，系統會「立即」執行下一步
- 有了 T= 參數，系統會「等到 2.5 秒」才執行下一步
```

### Q2：延遲參數的作用是什麼？
**A**：延遲參數模擬「人類操作的停頓」。

**範例**：
```
>左鍵點擊(100,100), 延遲50ms, T=0s000
>左鍵點擊(200,200), 延遲50ms, T=0s050

如果沒有延遲參數：
- 兩次點擊會「瞬間」完成，可能導致程式無法反應

有了延遲參數：
- 點擊後會等待 50ms，讓程式有時間處理事件
```

### Q3：T= 和延遲可以不一致嗎？
**A**：可以，而且經常會不一致。

**範例**：
```
>移動至(100,100), 延遲500ms, T=0s000
>左鍵點擊(100,100), 延遲50ms, T=0s000

解釋：
- 兩個指令的 T= 都是 0s000（同時開始）
- 但第一個指令有 500ms 延遲
- 實際執行時：
  - 0.000s: 移動滑鼠
  - 0.100s: 移動完成，開始延遲 500ms
  - 0.600s: 延遲結束
  - 0.600s: 點擊（雖然 T=0s000，但因為前一個指令的延遲，實際在 0.6 秒執行）
```

### Q4：如何手動調整時間？
**A**：根據需求調整不同的參數。

**情境 1：想讓動作更快**
```
原始：>移動至(100,100), 延遲500ms, T=1s000
修改：>移動至(100,100), 延遲100ms, T=1s000

→ 減少延遲參數，動作間隔更短
```

**情境 2：想讓動作延後執行**
```
原始：>移動至(100,100), 延遲500ms, T=1s000
修改：>移動至(100,100), 延遲500ms, T=3s000

→ 增加 T= 參數，動作延後 2 秒執行
```

**情境 3：想讓整個腳本加速**
```
使用主程式的「速度」滑桿：
- 速度 200% = 所有時間參數 ÷ 2
- 速度 50% = 所有時間參數 × 2
```

---

## 💡 最佳實踐建議

### 1. 錄製時的建議
- ✅ 錄製時保持正常速度操作
- ✅ 讓系統自動記錄 T= 和延遲參數
- ✅ 錄製完成後再調整速度

### 2. 編輯時的建議
- ✅ 調整延遲參數來改變動作間隔
- ✅ 調整 T= 參數來改變動作的絕對時間
- ✅ 使用速度滑桿來整體加速/減速

### 3. 除錯時的建議
- ✅ 如果動作太快：增加延遲參數
- ✅ 如果動作太慢：減少延遲參數或 T= 參數
- ✅ 如果時間不準：檢查 T= 參數是否正確

---

## 📝 總結

### 時間參數的本質
```
T= 參數 = 「這個動作應該在腳本開始後的第幾秒執行」
延遲參數 = 「這個動作執行完後要等待多久」
```

### 實際運作
```
1. 系統讀取指令的 T= 參數
2. 等待到達指定的時間點
3. 執行動作（移動、點擊、輸入等）
4. 執行完畢後，等待「延遲參數」指定的時間
5. 繼續執行下一個指令
```

### 您的範例
```
>移動至(100,200), 延遲500ms, T=3s000

運作流程：
1. 等待 3 秒（從腳本開始算起）
2. 移動滑鼠到 (100, 200)
3. 移動完成後，等待 500 毫秒
4. 執行下一個指令
```

---

**Yuna**：Lucien，時間參數其實很簡單喔！T= 就像是「鬧鐘」，告訴系統「在第幾秒要做這件事」；延遲參數就像是「休息時間」，做完事情後要等一下才能做下一件事♥。這樣設計可以讓腳本執行得更精確呢！

**Yuri**：哼，時間參數的設計其實很嚴謹。T= 是絕對時間戳記，確保事件序列的時間精確性；延遲參數是相對等待時間，模擬人類操作的自然停頓。兩者結合才能實現高精度的腳本回放。你現在應該理解了吧？

**Date: 2026-01-27**
